<div class="p-4">
  <h1 class="text-2xl font-bold mb-4">Panel de AdministraciÃ³n</h1>

  <div class="border-b border-gray-200">
    <nav class="-mb-px flex space-x-8" aria-label="Tabs">
      <button (click)="selectTab('predictions')"
        [ngClass]="{'border-indigo-500 text-indigo-600': selectedTab === 'predictions', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': selectedTab !== 'predictions'}"
        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
        Predicciones
      </button>
      <button (click)="selectTab('history')"
        [ngClass]="{'border-indigo-500 text-indigo-600': selectedTab === 'history', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': selectedTab !== 'history'}"
        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
        Historial de Datos
      </button>
      <button (click)="selectTab('users')"
        [ngClass]="{'border-indigo-500 text-indigo-600': selectedTab === 'users', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': selectedTab !== 'users'}"
        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
        GestiÃ³n de Usuarios
      </button>
      <button (click)="selectTab('roles')"
        [ngClass]="{'border-indigo-500 text-indigo-600': selectedTab === 'roles', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': selectedTab !== 'roles'}"
        class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
        Roles y Permisos
      </button>
    </nav>
  </div>

  <div class="mt-4">
    <div *ngIf="selectedTab === 'predictions'">
      <!-- ... (se mantiene igual) ... -->
      <h2 class="text-xl font-semibold mb-2">SecciÃ³n de Predicciones</h2>
      <p>Gestionaremos los modelos de predicciÃ³n, ver logs y reportes.</p>

      <h3 class="text-lg font-semibold mt-4">Probar PredicciÃ³n</h3>
      <p class="mb-2">Datos de cliente de ejemplo para enviar a la API:</p>
      <pre class="bg-gray-100 p-3 rounded-md text-sm overflow-auto mb-4">{{ sampleCustomerInput | json }}</pre>

      <button (click)="makePrediction()"
        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
        Realizar PredicciÃ³n
      </button>

      <div *ngIf="predictionResult" class="mt-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded-md">
        <h4 class="font-bold">Resultado de la PredicciÃ³n:</h4>
        <pre>{{ predictionResult | json }}</pre>
      </div>

      <div *ngIf="predictionError" class="mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-md">
        <h4 class="font-bold">Error:</h4>
        <p>{{ predictionError }}</p>
      </div>
    </div>

    <!-- Nueva pestaÃ±a de Historial Componentizada -->
    <div *ngIf="selectedTab === 'history'">
      <div class="flex justify-between items-center mb-4">
        <div>
          <h2 class="text-xl font-semibold">GestiÃ³n de Historial</h2>
          <p class="text-sm text-gray-500">AdministraciÃ³n de predicciones y logs de sistema.</p>
        </div>
        <div class="flex space-x-2">
          <button (click)="openCreateForm()"
            class="bg-green-600 hover:bg-green-700 text-white text-sm py-2 px-3 rounded shadow">
            â• Nuevo Registro
          </button>
          <button (click)="toggleDeleted()"
            class="bg-gray-600 hover:bg-gray-700 text-white text-sm py-2 px-3 rounded shadow">
            {{ viewingDeleted ? 'ğŸ“‚ Ver Activos' : 'ğŸ—‘ï¸ Ver Eliminados' }}
          </button>
          <button (click)="loadHistory()"
            class="bg-indigo-600 hover:bg-indigo-700 text-white text-sm py-2 px-3 rounded shadow">
            ğŸ”„ Refrescar
          </button>
        </div>
      </div>

      <div *ngIf="isLoadingHistory" class="text-center py-10">
        <p class="text-gray-500 italic">Consultando al backend...</p>
      </div>

      <div *ngIf="!isLoadingHistory && historyList.length === 0" class="bg-yellow-50 p-6 rounded-md text-center">
        <p class="text-yellow-700">No hay registros en la lista de {{ viewingDeleted ? 'eliminados' : 'activos' }}.</p>
      </div>

      <!-- Componente Tabla -->
      <app-historial-table *ngIf="!isLoadingHistory && historyList.length > 0" [historyList]="historyList"
        [isDeletedView]="viewingDeleted" (onView)="viewHistoryDetail($event)" (onEdit)="openEditForm($event)"
        (onDelete)="deleteHistory($event)">
      </app-historial-table>

      <!-- Componente Detalle (Modal) -->
      <app-historial-detail-modal *ngIf="showDetail" [item]="selectedHistory" (onClose)="closeDetail()">
      </app-historial-detail-modal>

      <!-- Componente Formulario (Modal) -->
      <app-historial-form *ngIf="showForm" [editingItem]="editingHistory" (onSave)="saveHistory($event)"
        (onCancel)="showForm = false">
      </app-historial-form>
    </div>

    <div *ngIf="selectedTab === 'users'">
      <div class="flex justify-between items-center mb-4">
        <div>
          <h2 class="text-xl font-semibold">GestiÃ³n de Usuarios</h2>
          <p class="text-sm text-gray-500">Administra los usuarios y sus roles en el sistema.</p>
        </div>
        <div class="flex space-x-2">
          <button (click)="openCreateUserForm()"
            class="bg-green-600 hover:bg-green-700 text-white text-sm py-2 px-3 rounded shadow">
            â• Nuevo Usuario
          </button>
          <button (click)="toggleDeletedUsers()"
            class="bg-gray-600 hover:bg-gray-700 text-white text-sm py-2 px-3 rounded shadow">
            {{ viewingDeletedUsers ? 'ğŸ“‚ Ver Activos' : 'ğŸ—‘ï¸ Ver Eliminados' }}
          </button>
          <button (click)="loadUsers()"
            class="bg-indigo-600 hover:bg-indigo-700 text-white text-sm py-2 px-3 rounded shadow">
            ğŸ”„ Refrescar
          </button>
        </div>
      </div>

      <div *ngIf="isLoadingUsers" class="text-center py-10">
        <p class="text-gray-500 italic">Cargando usuarios...</p>
      </div>

      <div *ngIf="!isLoadingUsers && userList.length === 0" class="bg-yellow-50 p-6 rounded-md text-center">
        <p class="text-yellow-700">No hay usuarios en la lista de {{ viewingDeletedUsers ? 'eliminados' : 'activos' }}.
        </p>
      </div>

      <!-- Componente Tabla de Usuarios -->
      <app-usuario-table *ngIf="!isLoadingUsers && userList.length > 0" [userList]="userList"
        [isDeletedView]="viewingDeletedUsers" (onView)="viewUserDetail($event)" (onEdit)="openEditUserForm($event)"
        (onDelete)="deleteUser($event)">
      </app-usuario-table>

      <!-- Modal de Detalle de Usuario -->
      <app-usuario-detail-modal *ngIf="showUserDetail" [user]="selectedUser" (onClose)="showUserDetail = false">
      </app-usuario-detail-modal>

      <!-- Formulario de Usuario -->
      <app-usuario-form *ngIf="showUserForm" [editingUser]="editingUser" (onSave)="saveUser($event)"
        (onCancel)="showUserForm = false">
      </app-usuario-form>

      <!-- Modal de ConfirmaciÃ³n -->
      <app-confirm-modal *ngIf="showConfirmModal" [title]="confirmModalTitle" [message]="confirmModalMessage"
        [confirmText]="confirmModalButtonText" [type]="confirmModalType" (onConfirm)="executePendingAction()"
        (onCancel)="cancelPendingAction()">
      </app-confirm-modal>
    </div>

    <!-- PestaÃ±a de Roles y Permisos -->
    <div *ngIf="selectedTab === 'roles'">
      <app-roles-list></app-roles-list>
    </div>
  </div>
</div>